<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiriBot IK Portalı</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Hiri.ai Renk Paleti ve Temel Stiller */
        :root { 
            --hiri-purple: #7C3AED; 
            --hiri-purple-dark: #6D28D9; 
            --hiri-blue: #3B82F6; 
            --hiri-border-color: #CBD5E1; 
            --hiri-light-purple: #F3E8FF;
            --hiri-lighter-purple: #E9D5FF;
            --hiri-text-color: #1E293B;
            --hiri-bg-color: #F8FAFC;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: var(--hiri-bg-color);
            color: var(--hiri-text-color);
            margin: 0;
            padding: 0;
        }

        /* Hiri.ai Buton Stilleri */
        .hiri-button { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 600; 
            padding: 0.65rem 1.3rem; 
            border-radius: 0.5rem; 
            transition: all 0.25s; 
            border: 1px solid transparent; 
            box-shadow: 0 1px 2px 0 rgba(16, 24, 40, 0.05); 
        }
        .hiri-button-primary { 
            background-color: var(--hiri-purple); 
            color: white; 
        }
        .hiri-button-primary:hover { 
            background-color: var(--hiri-purple-dark); 
            transform: translateY(-2px); 
            box-shadow: 0 8px 16px -4px rgba(124,58,237,0.35); 
        }
        .hiri-button-secondary { 
            background-color: var(--hiri-light-purple);
            color: var(--hiri-purple); 
            border: 1px solid #D8B4FE;
        }
        .hiri-button-secondary:hover { 
            background-color: var(--hiri-lighter-purple); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        /* Hiri.ai Kart Stilleri */
        .hiri-card { 
            background-color: white; 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            box-shadow: 0 4px 12px -1px rgba(0,0,0,0.05); 
            border: 1px solid #E5E7EB; 
        }

        /* Hiri.ai Input Stilleri */
        .hiri-input { 
            border: 1px solid var(--hiri-border-color); 
            border-radius: 0.5rem; 
            padding: 0.75rem 0.9rem; 
            width: 100%; 
            transition: all 0.2s; 
            background-color: #F9FAFB; 
        }
        .hiri-input:focus { 
            outline: none; 
            border-color: var(--hiri-purple); 
            box-shadow: 0 0 0 3px rgba(124,58,237,0.2); 
        }

        .main-content {
            display: flex;
            min-height: calc(100vh - 64px); /* Header yüksekliği 64px */
        }
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #E5E7EB;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #4B5563;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        .sidebar-item:hover {
            background-color: #F3F4F6;
            color: var(--hiri-purple);
        }
        .sidebar-item.active {
            background-color: var(--hiri-light-purple);
            color: var(--hiri-purple);
            font-weight: 600;
        }

        .content-area {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px; /* Satırlar arasında boşluk */
        }
        th, td {
            padding: 12px 16px;
            text-align: left;
        }
        th {
            background-color: #F9FAFB;
            font-weight: 600;
            color: #4B5563;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        th:first-child { border-top-left-radius: 0.5rem; }
        th:last-child { border-top-right-radius: 0.5rem; }
        td {
            background-color: white;
            border-bottom: 1px solid #E5E7EB;
            font-size: 0.9rem;
            color: #374151;
        }
        tr:last-child td { border-bottom: none; }
        tr {
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        tr:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        tr td:first-child { border-top-left-radius: 0.5rem; border-bottom-left-radius: 0.5rem; }
        tr td:last-child { border-top-right-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }

        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tag-green { background-color: #D1FAE5; color: #059669; } /* Tamamlandı */
        .tag-blue { background-color: #DBEAFE; color: #2563EB; } /* Başladı */
        .tag-orange { background-color: #FEF3C7; color: #D97706; } /* Form Bekleniyor */
        .tag-gray { background-color: #E5E7EB; color: #4B5563; } /* Beklemede */

        /* Modal Stilleri */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(30,41,59,0.7); 
            backdrop-filter: blur(4px); 
            align-items: center; 
            justify-content: center; 
        }
        .modal.is-open { 
            display: flex; 
        }
        .modal-content { 
            background-color: #fff; 
            margin: auto; 
            padding: 2rem; 
            border: none; 
            width: 90%; 
            max-width: 700px; /* Daha geniş modal */
            border-radius: 0.75rem; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.3); 
            display: flex; 
            flex-direction: column; 
            max-height: 90vh; /* Yüksekliği artırıldı */
            overflow-y: auto; /* İçerik taşarsa scroll */
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding-bottom: 1rem; 
            border-bottom: 1px solid #e5e7eb; 
            margin-bottom: 1rem;
        }
        .modal-body { 
            flex-grow: 1; 
            overflow-y: auto; 
        }
        .modal-footer {
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        .competency-selection-group,
        .general-info-selection-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background-color: #F9FAFB;
            border: 1px solid var(--hiri-border-color);
            border-radius: 0.5rem;
            padding: 1rem;
        }
        .competency-tag,
        .general-info-tag {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            border: 1px solid var(--hiri-border-color);
            background-color: white;
            color: #4B5563;
        }
        .competency-tag:hover,
        .general-info-tag:hover {
            background-color: #F3F4F6;
            color: var(--hiri-purple);
            border-color: var(--hiri-purple);
        }
        .competency-tag.selected,
        .general-info-tag.selected {
            background-color: var(--hiri-purple);
            color: white;
            border-color: var(--hiri-purple);
        }
        .selected-questions-preview {
            background-color: #F9FAFB;
            border: 1px solid var(--hiri-border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 80px;
            font-size: 0.9rem;
            color: #374151;
        }
        .selected-questions-preview ul {
            list-style: disc;
            margin-left: 1.25rem;
        }
        .selected-questions-preview p {
            color: #6B7280;
        }

        /* Rapor Detay Stilleri */
        .report-section {
            background-color: #F9FAFB;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #E5E7EB;
        }
        .report-section h3 {
            font-weight: 600;
            color: var(--hiri-purple);
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #E5E7EB;
            padding-bottom: 0.5rem;
        }
        .report-qa p {
            margin-bottom: 0.5rem;
        }
        .report-qa strong {
            color: var(--hiri-text-color);
        }
        .report-score {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--hiri-blue);
        }
        .report-missing-info {
            background-color: #FEF2F2;
            border: 1px solid #EF4444;
            color: #DC2626;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .report-missing-info ul {
            list-style: disc;
            margin-left: 1.25rem;
        }
        .language-assessment-score {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--hiri-blue);
        }
    </style>
</head>
<body>
    <div id="appView" class="flex flex-col min-h-screen">
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <img src="https://placehold.co/130x40/7C3AED/FFFFFF?text=Hiri.ai" alt="Hiri.ai Logosu" class="h-10">
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm font-semibold hidden sm:inline">Turkcell İnsan Kaynakları</span>
                        <button class="h-9 w-9 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-sm font-bold hover:bg-slate-300 transition-colors">İK</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div id="dashboard-sidebar-item" class="sidebar-item active">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </div>
                <div id="candidates-sidebar-item" class="sidebar-item">
                    <i class="fas fa-users"></i>
                    <span>Adaylar</span>
                </div>
                <div id="interviews-sidebar-item" class="sidebar-item">
                    <i class="fas fa-video"></i>
                    <span>Mülakatlar</span>
                </div>
                <div id="reports-sidebar-item" class="sidebar-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Raporlar</span>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="section active">
                    <h1 class="text-2xl font-bold mb-6">İK Dashboard</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="hiri-card flex flex-col items-center justify-center p-6 text-center">
                            <i class="fas fa-user-plus text-5xl text-purple-600 mb-4"></i>
                            <h2 class="text-lg font-semibold mb-1">Toplam Aday</h2>
                            <p class="text-3xl font-bold text-slate-800">125</p>
                        </div>
                        <div class="hiri-card flex flex-col items-center justify-center p-6 text-center">
                            <i class="fas fa-video text-5xl text-blue-500 mb-4"></i>
                            <h2 class="text-lg font-semibold mb-1">Tamamlanan Mülakat</h2>
                            <p class="text-3xl font-bold text-slate-800">42</p>
                        </div>
                        <div class="hiri-card flex flex-col items-center justify-center p-6 text-center">
                            <i class="fas fa-hourglass-half text-5xl text-orange-500 mb-4"></i>
                            <h2 class="text-lg font-semibold mb-1">Bekleyen Mülakat</h2>
                            <p class="text-3xl font-bold text-slate-800">8</p>
                        </div>
                    </div>

                    <h2 class="text-xl font-bold mt-8 mb-4">Son Mülakatlar</h2>
                    <div class="hiri-card p-0 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aday Adı</th>
                                    <th>Pozisyon</th>
                                    <th>Durum</th>
                                    <th>Tarih</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="latest-interviews-table-body">
                                <!-- Data will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Candidates Section -->
                <section id="candidates-section" class="section">
                    <h1 class="text-2xl font-bold mb-6">Aday Havuzu</h1>
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="select-all-candidates" class="form-checkbox h-5 w-5 text-purple-600 rounded">
                            <label for="select-all-candidates" class="text-slate-700 font-medium">Tümünü Seç</label>
                            <span id="selected-candidates-count" class="text-sm text-slate-500 ml-2">(0 Aday Seçili)</span>
                        </div>
                        <button id="send-bulk-interview-btn" class="hiri-button hiri-button-primary text-sm" disabled>
                            <i class="fas fa-paper-plane mr-2"></i> Toplu Mülakat Gönder
                        </button>
                    </div>
                    <div class="hiri-card p-0 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th class="w-12"></th> <!-- Checkbox column -->
                                    <th>Aday Adı</th>
                                    <th>Pozisyon</th>
                                    <th>CV</th>
                                    <th>Durum</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="candidates-table-body">
                                <!-- Data will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Interviews Section -->
                <section id="interviews-section" class="section">
                    <h1 class="text-2xl font-bold mb-6">Tüm Mülakatlar</h1>
                    <div class="hiri-card p-0 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aday Adı</th>
                                    <th>Pozisyon</th>
                                    <th>Durum</th>
                                    <th>Başlangıç</th>
                                    <th>Bitiş</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="all-interviews-table-body">
                                <!-- Data will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports-section" class="section">
                    <h1 class="text-2xl font-bold mb-6">Mülakat Raporları</h1>
                    <div class="hiri-card p-0 overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th>Aday Adı</th>
                                    <th>Pozisyon</th>
                                    <th>Değerlendirme</th>
                                    <th>Rapor Tarihi</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="reports-table-body">
                                <!-- Data will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Single Interview Setup Modal (Existing) -->
    <div id="interview-setup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-semibold">HiriBot Mülakatı Başlat</h2>
                <button class="text-slate-400 hover:text-slate-600 text-2xl" id="close-setup-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mb-4">Seçilen Aday: <strong id="setup-candidate-name"></strong> - <span id="setup-candidate-position"></span></p>
                
                <div class="report-section mb-4">
                    <h3>CV Analizi Özeti (Simülasyon)</h3>
                    <p class="text-sm text-slate-600 mb-2">HiriBot, adayın CV'sini otomatik olarak analiz etti:</p>
                    <ul class="list-disc list-inside text-sm text-slate-600">
                        <li>Belirtilen Yetkinlikler: Proje Yönetimi, Python, Veri Analizi</li>
                        <li>Eksik/Net Olmayan Alanlar: Liderlik Deneyimi, Çatışma Çözme Becerisi</li>
                    </ul>
                </div>

                <!-- Mülakat Dili Seçimi -->
                <div class="form-group">
                    <label class="block text-base font-semibold mb-2" for="interview-language">Mülakat Dili:</label>
                    <p class="text-sm text-slate-600 mb-3">HiriBot adayı bu dilde karşılayacak ve tüm mülakatı bu dilde yürütecektir.</p>
                    <select id="interview-language" class="hiri-input">
                        <option value="tr">Türkçe</option>
                        <option value="en">English</option>
                    </select>
                </div>

                <!-- İkinci Dil Yetkinliği Değerlendirme -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Ek Dil Yetkinliği Değerlendir:</label>
                    <p class="text-sm text-slate-600 mb-3">Adayın mülakat sırasında ek bir dilde (örn. İngilizce) yetkinliğinin değerlendirilmesini ister misiniz?</p>
                    <div class="flex items-center gap-4">
                        <input type="checkbox" id="assess-second-language" class="form-checkbox h-5 w-5 text-purple-600 rounded">
                        <label for="assess-second-language" class="text-slate-700 font-medium">İngilizce Yetkinliğini Değerlendir</label>
                    </div>
                </div>

                <!-- NEW: Şablon Yükle -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2" for="load-template-select">Şablon Yükle:</label>
                    <p class="text-sm text-slate-600 mb-3">Önceden kaydettiğiniz bir soru şablonunu yükleyerek mevcut seçimleri otomatik doldurun.</p>
                    <div class="flex gap-2">
                        <select id="load-template-select" class="hiri-input flex-grow">
                            <option value="">Şablon Seçiniz</option>
                        </select>
                        <button id="load-template-btn" class="hiri-button hiri-button-secondary text-sm" disabled>Yükle</button>
                    </div>
                </div>

                <!-- Pozisyona Özel Yetkinlikler (Soru Kütüphanesi Konsepti) -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Pozisyona Özel Yetkinlikler (Soru Kütüphanesi):</label>
                    <p class="text-sm text-slate-600 mb-3">HiriBot'un mülakat sırasında hangi yetkinlikler üzerine odaklanmasını istersiniz? Seçtiğiniz yetkinliklerden rastgele sorular soracaktır.</p>
                    <div id="competency-selection-group" class="competency-selection-group">
                        <button class="competency-tag" data-competency="Liderlik">Liderlik</button>
                        <button class="competency-tag" data-competency="Problem Çözme">Problem Çözme</button>
                        <button class="competency-tag" data-competency="İletişim">İletişim</button>
                        <button class="competency-tag" data-competency="Ekip Çalışması">Ekip Çalışması</button>
                        <button class="competency-tag" data-competency="Adaptasyon">Adaptasyon</button>
                        <button class="competency-tag" data-competency="Teknik Bilgi">Teknik Bilgi</button>
                        <!-- Diğer yetkinlikler buraya eklenebilir -->
                    </div>
                    <div id="selected-competencies-preview" class="selected-questions-preview mt-3">
                        <p>Seçilen yetkinlikler: Yok</p>
                    </div>
                </div>

                <!-- Ek Bilgiler ve Özel Konular (Soru Kütüphanesi Konsepti) -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Ek Bilgiler ve Özel Konular (Soru Kütüphanesi):</label>
                    <p class="text-sm text-slate-600 mb-3">Adaydan mülakat sırasında öğrenmek istediğiniz CV dışı genel bilgileri seçin.</p>
                    <div id="general-info-selection-group" class="general-info-selection-group">
                        <button class="general-info-tag" data-topic="Maaş Beklentisi">Maaş Beklentisi</button>
                        <button class="general-info-tag" data-topic="Hibrit Çalışma Uyumu">Hibrit Çalışma Uyumu</button>
                        <button class="general-info-tag" data-topic="Seyahat Engeli">Seyahat Engeli</button>
                        <button class="general-info-tag" data-topic="Kariyer Motivasyonu">Kariyer Motivasyonu</button>
                        <!-- Diğer genel konular buraya eklenebilir -->
                    </div>
                    <div id="selected-general-info-preview" class="selected-questions-preview mt-3">
                        <p>Seçilen konular: Yok</p>
                    </div>
                </div>

                <!-- Manuel Özel Soru Ekle -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2" for="manual-custom-question">Manuel Özel Soru Ekle:</label>
                    <p class="text-sm text-slate-600 mb-3">Yukarıdaki kategorilere uymayan, HiriBot'un adaya sormasını istediğiniz spesifik bir soru ekleyin.</p>
                    <input type="text" id="manual-custom-question" class="hiri-input" placeholder="Örn: X projesindeki rolünüz neydi?">
                    <button id="add-manual-custom-question-btn" class="hiri-button hiri-button-secondary mt-2 text-sm">Soru Ekle</button>
                    <div id="selected-manual-questions-preview" class="selected-questions-preview mt-3">
                        <p>Eklenen manuel sorular: Yok</p>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button id="save-template-btn" class="hiri-button hiri-button-secondary">Şablon Olarak Kaydet</button>
                <button id="cancel-setup-btn" class="hiri-button hiri-button-secondary">İptal</button>
                <button id="start-interview-process-btn" class="hiri-button hiri-button-primary">Mülakatı Başlat</button>
            </div>
        </div>
    </div>

    <!-- NEW: Bulk Interview Setup Modal -->
    <div id="bulk-interview-setup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-semibold">Toplu Mülakat Daveti Gönder</h2>
                <button class="text-slate-400 hover:text-slate-600 text-2xl" id="close-bulk-setup-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mb-4"><strong id="bulk-candidate-count">0</strong> Aday için toplu mülakat ayarları:</p>
                
                <!-- Mülakat Dili Seçimi -->
                <div class="form-group">
                    <label class="block text-base font-semibold mb-2" for="bulk-interview-language">Mülakat Dili:</label>
                    <p class="text-sm text-slate-600 mb-3">HiriBot adayları bu dilde karşılayacak ve tüm mülakatı bu dilde yürütecektir.</p>
                    <select id="bulk-interview-language" class="hiri-input">
                        <option value="tr">Türkçe</option>
                        <option value="en">English</option>
                    </select>
                </div>

                <!-- İkinci Dil Yetkinliği Değerlendirme -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Ek Dil Yetkinliği Değerlendir:</label>
                    <p class="text-sm text-slate-600 mb-3">Adayların mülakat sırasında ek bir dilde (örn. İngilizce) yetkinliğinin değerlendirilmesini ister misiniz?</p>
                    <div class="flex items-center gap-4">
                        <input type="checkbox" id="bulk-assess-second-language" class="form-checkbox h-5 w-5 text-purple-600 rounded">
                        <label for="bulk-assess-second-language" class="text-slate-700 font-medium">İngilizce Yetkinliğini Değerlendir</label>
                    </div>
                </div>

                <!-- NEW: Şablon Yükle (Bulk) -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2" for="bulk-load-template-select">Şablon Yükle:</label>
                    <p class="text-sm text-slate-600 mb-3">Önceden kaydettiğiniz bir soru şablonunu yükleyerek mevcut seçimleri otomatik doldurun.</p>
                    <div class="flex gap-2">
                        <select id="bulk-load-template-select" class="hiri-input flex-grow">
                            <option value="">Şablon Seçiniz</option>
                        </select>
                        <button id="bulk-load-template-btn" class="hiri-button hiri-button-secondary text-sm" disabled>Yükle</button>
                    </div>
                </div>

                <!-- Pozisyona Özel Yetkinlikler (Soru Kütüphanesi Konsepti) -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Pozisyona Özel Yetkinlikler (Soru Kütüphanesi):</label>
                    <p class="text-sm text-slate-600 mb-3">HiriBot'un mülakat sırasında hangi yetkinlikler üzerine odaklanmasını istersiniz? Seçtiğiniz yetkinliklerden rastgele sorular soracaktır.</p>
                    <div id="bulk-competency-selection-group" class="competency-selection-group">
                        <button class="competency-tag" data-competency="Liderlik">Liderlik</button>
                        <button class="competency-tag" data-competency="Problem Çözme">Problem Çözme</button>
                        <button class="competency-tag" data-competency="İletişim">İletişim</button>
                        <button class="competency-tag" data-competency="Ekip Çalışması">Ekip Çalışması</button>
                        <button class="competency-tag" data-competency="Adaptasyon">Adaptasyon</button>
                        <button class="competency-tag" data-competency="Teknik Bilgi">Teknik Bilgi</button>
                    </div>
                    <div id="bulk-selected-competencies-preview" class="selected-questions-preview mt-3">
                        <p>Seçilen yetkinlikler: Yok</p>
                    </div>
                </div>

                <!-- Ek Bilgiler ve Özel Konular (Soru Kütüphanesi Konsepti) -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2">Ek Bilgiler ve Özel Konular (Soru Kütüphanesi):</label>
                    <p class="text-sm text-slate-600 mb-3">Adaylardan mülakat sırasında öğrenmek istediğiniz CV dışı genel bilgileri seçin.</p>
                    <div id="bulk-general-info-selection-group" class="general-info-selection-group">
                        <button class="general-info-tag" data-topic="Maaş Beklentisi">Maaş Beklentisi</button>
                        <button class="general-info-tag" data-topic="Hibrit Çalışma Uyumu">Hibrit Çalışma Uyumu</button>
                        <button class="general-info-tag" data-topic="Seyahat Engeli">Seyahat Engeli</button>
                        <button class="general-info-tag" data-topic="Kariyer Motivasyonu">Kariyer Motivasyonu</button>
                    </div>
                    <div id="bulk-selected-general-info-preview" class="selected-questions-preview mt-3">
                        <p>Seçilen konular: Yok</p>
                    </div>
                </div>

                <!-- Manuel Özel Soru Ekle -->
                <div class="form-group mt-6">
                    <label class="block text-base font-semibold mb-2" for="bulk-manual-custom-question">Manuel Özel Soru Ekle:</label>
                    <p class="text-sm text-slate-600 mb-3">Yukarıdaki kategorilere uymayan, HiriBot'un adaylara sormasını istediğiniz spesifik bir soru ekleyin.</p>
                    <input type="text" id="bulk-manual-custom-question" class="hiri-input" placeholder="Örn: X projesindeki rolünüz neydi?">
                    <button id="bulk-add-manual-custom-question-btn" class="hiri-button hiri-button-secondary mt-2 text-sm">Soru Ekle</button>
                    <div id="bulk-selected-manual-questions-preview" class="selected-questions-preview mt-3">
                        <p>Eklenen manuel sorular: Yok</p>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button id="bulk-save-template-btn" class="hiri-button hiri-button-secondary">Şablon Olarak Kaydet</button>
                <button id="bulk-cancel-setup-btn" class="hiri-button hiri-button-secondary">İptal</button>
                <button id="bulk-start-interview-process-btn" class="hiri-button hiri-button-primary">Davetleri Gönder ve Mülakatları Başlat</button>
            </div>
        </div>
    </div>

    <!-- Interview Report Modal -->
    <div id="interview-report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-semibold">Mülakat Raporu: <span id="report-candidate-name"></span></h2>
                <button class="text-slate-400 hover:text-slate-600 text-2xl" id="close-report-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-section">
                    <h3>Genel Değerlendirme</h3>
                    <p class="text-sm text-slate-600 mb-2">HiriBot'un adayın genel performansı hakkındaki özeti:</p>
                    <p id="report-summary" class="text-slate-700"></p>
                    <p class="mt-4">HiriBot Değerlendirme Skoru: <span id="report-score" class="report-score"></span></p>
                </div>

                <div class="report-section">
                    <h3>Sorular ve Yanıtlar</h3>
                    <div id="report-qa-list" class="report-qa text-sm text-slate-600">
                        <!-- Questions and answers will be populated by JS -->
                    </div>
                </div>

                <div class="report-section">
                    <h3>Yetkinlik Değerlendirmesi</h3>
                    <ul id="report-competency-list" class="list-disc list-inside text-sm text-slate-600">
                        <!-- Competency scores will be populated by JS -->
                    </ul>
                </div>

                <!-- İkinci Dil Yetkinliği Değerlendirme Sonucu -->
                <div id="report-second-language-section" class="report-section hidden">
                    <h3>İkinci Dil Yetkinliği (İngilizce)</h3>
                    <p class="text-sm text-slate-600 mb-2">HiriBot'un İngilizce mülakat performansı değerlendirmesi:</p>
                    <p id="report-second-language-score" class="language-assessment-score"></p>
                    <p id="report-second-language-summary" class="text-sm text-slate-700 mt-2"></p>
                </div>

                <div id="report-missing-info-section" class="report-missing-info hidden">
                    <h3>Eksik Bilgiler</h3>
                    <p class="text-sm">Mülakat sırasında netleşmeyen veya ek bilgi gerektiren alanlar:</p>
                    <ul id="report-missing-info-list" class="mt-2">
                        <!-- Missing info will be populated by JS -->
                    </ul>
                </div>

            </div>
            <div class="modal-footer">
                <button id="send-additional-form-btn" class="hiri-button hiri-button-primary">Ek Form Gönder</button>
                <button id="close-report-final-btn" class="hiri-button hiri-button-secondary">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Additional Form View Modal (Submitted by Candidate) -->
    <div id="additional-form-view-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-semibold">Ek Bilgi Formu Yanıtları: <span id="form-view-candidate-name"></span></h2>
                <button class="text-slate-400 hover:text-slate-600 text-2xl" id="close-form-view-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-section">
                    <h3>Genel Bilgiler</h3>
                    <p class="text-sm text-slate-600 mb-2"><strong>Ofise Gelme Sıklığı:</strong> <span id="form-view-office-days"></span></p>
                    <p class="text-sm text-slate-600 mb-2"><strong>Seyahat Engeli:</strong> <span id="form-view-travel-restriction"></span></p>
                </div>
                <div class="report-section">
                    <h3>Kariyer Motivasyonu</h3>
                    <p class="text-sm text-slate-600" id="form-view-career-motivation"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="hiri-button hiri-button-secondary" id="close-form-view-final-btn">Kapat</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elementleri ---
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            const sections = document.querySelectorAll('.section');

            const candidatesTableBody = document.getElementById('candidates-table-body');
            const allInterviewsTableBody = document.getElementById('all-interviews-table-body');
            const reportsTableBody = document.getElementById('reports-table-body');
            const latestInterviewsTableBody = document.getElementById('latest-interviews-table-body');

            // Single Interview Setup Modal Elements
            const interviewSetupModal = document.getElementById('interview-setup-modal');
            const closeSetupModalBtn = document.getElementById('close-setup-modal');
            const cancelSetupBtn = document.getElementById('cancel-setup-btn');
            const setupCandidateName = document.getElementById('setup-candidate-name');
            const setupCandidatePosition = document.getElementById('setup-candidate-position');
            const startInterviewProcessBtn = document.getElementById('start-interview-process-btn');
            const manualCustomQuestionInput = document.getElementById('manual-custom-question');
            const addManualCustomQuestionBtn = document.getElementById('add-manual-custom-question-btn');
            const interviewLanguageSelect = document.getElementById('interview-language');
            const assessSecondLanguageCheckbox = document.getElementById('assess-second-language');
            const competencySelectionGroup = document.getElementById('competency-selection-group');
            const competencyTags = document.querySelectorAll('#competency-selection-group .competency-tag'); // Specific selector
            const selectedCompetenciesPreview = document.getElementById('selected-competencies-preview');
            const generalInfoSelectionGroup = document.getElementById('general-info-selection-group');
            const generalInfoTags = document.querySelectorAll('#general-info-selection-group .general-info-tag'); // Specific selector
            const selectedGeneralInfoPreview = document.getElementById('selected-general-info-preview');
            const selectedManualQuestionsPreview = document.getElementById('selected-manual-questions-preview');
            const saveTemplateBtn = document.getElementById('save-template-btn'); // NEW
            const loadTemplateSelect = document.getElementById('load-template-select'); // NEW
            const loadTemplateBtn = document.getElementById('load-template-btn'); // NEW

            // NEW: Bulk Interview Setup Modal Elements
            const bulkInterviewSetupModal = document.getElementById('bulk-interview-setup-modal');
            const closeBulkSetupModalBtn = document.getElementById('close-bulk-setup-modal');
            const bulkCancelSetupBtn = document.getElementById('bulk-cancel-setup-btn');
            const bulkCandidateCountSpan = document.getElementById('bulk-candidate-count');
            const bulkStartInterviewProcessBtn = document.getElementById('bulk-start-interview-process-btn');
            const bulkInterviewLanguageSelect = document.getElementById('bulk-interview-language');
            const bulkAssessSecondLanguageCheckbox = document.getElementById('bulk-assess-second-language');
            const bulkCompetencySelectionGroup = document.getElementById('bulk-competency-selection-group');
            const bulkCompetencyTags = document.querySelectorAll('#bulk-competency-selection-group .competency-tag'); // Specific selector
            const bulkSelectedCompetenciesPreview = document.getElementById('bulk-selected-competencies-preview');
            const bulkGeneralInfoSelectionGroup = document.getElementById('bulk-general-info-selection-group');
            const bulkGeneralInfoTags = document.querySelectorAll('#bulk-general-info-selection-group .general-info-tag'); // Specific selector
            const bulkSelectedGeneralInfoPreview = document.getElementById('bulk-selected-general-info-preview');
            const bulkManualCustomQuestionInput = document.getElementById('bulk-manual-custom-question');
            const bulkAddManualCustomQuestionBtn = document.getElementById('bulk-add-manual-custom-question-btn');
            const bulkSelectedManualQuestionsPreview = document.getElementById('bulk-selected-manual-questions-preview');
            const bulkSaveTemplateBtn = document.getElementById('bulk-save-template-btn'); // NEW
            const bulkLoadTemplateSelect = document.getElementById('bulk-load-template-select'); // NEW
            const bulkLoadTemplateBtn = document.getElementById('bulk-load-template-btn'); // NEW

            // Report Modal Elements
            const interviewReportModal = document.getElementById('interview-report-modal');
            const closeReportModalBtn = document.getElementById('close-report-modal');
            const closeReportFinalBtn = document.getElementById('close-report-final-btn');
            const reportCandidateName = document.getElementById('report-candidate-name');
            const reportSummary = document.getElementById('report-summary');
            const reportScore = document.getElementById('report-score');
            const reportQaList = document.getElementById('report-qa-list');
            const reportCompetencyList = document.getElementById('report-competency-list');
            const reportSecondLanguageSection = document.getElementById('report-second-language-section');
            const reportSecondLanguageScore = document.getElementById('report-second-language-score');
            const reportSecondLanguageSummary = document.getElementById('report-second-language-summary');
            const reportMissingInfoSection = document.getElementById('report-missing-info-section');
            const reportMissingInfoList = document.getElementById('report-missing-info-list');
            const sendAdditionalFormBtn = document.getElementById('send-additional-form-btn');

            // Additional Form View Modal Elements
            const additionalFormViewModal = document.getElementById('additional-form-view-modal');
            const closeFormViewModalBtn = document.getElementById('close-form-view-modal');
            const closeFormViewFinalBtn = document.getElementById('close-form-view-final-btn');
            const formViewCandidateName = document.getElementById('form-view-candidate-name');
            const formViewOfficeDays = document.getElementById('form-view-office-days');
            const formViewTravelRestriction = document.getElementById('form-view-travel-restriction');
            const formViewCareerMotivation = document.getElementById('form-view-career-motivation');

            // Candidate Selection Elements
            const selectAllCandidatesCheckbox = document.getElementById('select-all-candidates');
            const selectedCandidatesCountSpan = document.getElementById('selected-candidates-count');
            const sendBulkInterviewBtn = document.getElementById('send-bulk-interview-btn');

            // --- Data ---
            const DUMMY_DATA = {
                candidates: [
                    { id: 'c1', name: 'Ayşe Yılmaz', position: 'Yazılım Geliştirici', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c2', name: 'Can Boz', position: 'Pazarlama Uzmanı', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c3', name: 'Zeynep Kaya', position: 'İş Analisti', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c4', name: 'Deniz Aktaş', position: 'İnsan Kaynakları Uzmanı', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c5', name: 'Burak Demir', position: 'Yazılım Geliştirici', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c6', name: 'Elif Can', position: 'Pazarlama Uzmanı', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c7', name: 'Fatih Koç', position: 'İş Analisti', cvUrl: '#', status: 'Beklemede' },
                    { id: 'c8', name: 'Gül Erdem', position: 'İnsan Kaynakları Uzmanı', cvUrl: '#', status: 'Beklemede' },
                ],
                interviews: [
                    // Örnek mülakatlar
                    { 
                        id: 'i1', 
                        candidateId: 'c1', 
                        candidateName: 'Ayşe Yılmaz', 
                        position: 'Yazılım Geliştirici', 
                        status: 'Tamamlandı', 
                        startDate: '2025-07-10 10:00', 
                        endDate: '2025-07-10 10:15',
                        report: {
                            summary: "Ayşe Yılmaz, yazılım geliştirme alanındaki güçlü teknik bilgisi ve problem çözme becerileriyle dikkat çekiyor. Ekip çalışmasına yatkınlığı ve öğrenmeye açık yapısı pozisyon için olumlu. Ancak liderlik deneyimi konusunda daha fazla detay alınması faydalı olacaktır.",
                            score: 85,
                            qa: [
                                { q: "Kendinizden ve kariyer hedeflerinizden bahseder misiniz?", a: "Ayşe, X Üniversitesi'nden mezun olduğunu ve Y yıldır yazılım geliştirme alanında çalıştığını belirtti. Kariyer hedefinin Full-Stack Developer olarak uzmanlaşmak olduğunu ifade etti." },
                                { q: "Önceki iş deneyimlerinizde karşılaştığınız en büyük zorluk neydi ve bu zorluğun üstesinden nasıl geldiniz?", a: "Bir projede beklenmedik bir entegrasyon sorunuyla karşılaştığını, ekip arkadaşlarıyla birlikte farklı API dokümantasyonlarını inceleyerek ve testler yaparak sorunu çözdüklerini anlattı." },
                                { q: "Ekip çalışmasına ne kadar yatkınsınız? Bir ekip projesindeki rolünüzü ve katkılarınızı örnekleyerek anlatır mısınız?", a: "Ekip projelerinde aktif rol aldığını, özellikle kod incelemeleri ve bilgi paylaşımı konusunda katkı sağladığını belirtti. Bir örnekle, zor bir modülün geliştirilmesinde ekip üyelerine destek olduğunu ifade etti." }
                            ],
                            competencies: [
                                { name: "Teknik Bilgi", score: "Yüksek" },
                                { name: "Problem Çözme", score: "Yüksek" },
                                { name: "Ekip Çalışması", score: "Orta-Yüksek" },
                                { name: "Liderlik", score: "Düşük (Geliştirilebilir)" },
                                { name: "İletişim", score: "Orta" }
                            ],
                            secondLanguage: { 
                                score: "B2 (Upper-Intermediate)",
                                summary: "Adayın İngilizce konuşma akıcılığı iyi seviyede. Karmaşık cümleler kurabiliyor ve kendini rahat ifade edebiliyor. Telaffuzda küçük aksaklıklar mevcut ancak anlaşılırlığı etkilemiyor."
                            },
                            missingInfo: ["Liderlik deneyimi örnekleri", "Çatışma çözme becerisi"]
                        },
                        additionalForm: null
                    },
                    { 
                        id: 'i3', 
                        candidateId: 'c3', 
                        candidateName: 'Zeynep Kaya', 
                        position: 'İş Analisti', 
                        status: 'Form Bekleniyor', 
                        startDate: '2025-07-09 11:00', 
                        endDate: '2025-07-09 11:15',
                        report: {
                            summary: "Zeynep Kaya, iş analizi süreçlerindeki yetkinliği ve detay odaklı yaklaşımıyla öne çıkıyor. İletişim becerileri güçlü. Ancak ofise gelme sıklığı ve seyahat engeli gibi pratik bilgiler netleştirilmeli.",
                            score: 80,
                            qa: [
                                { q: "Kendinizden ve kariyer hedeflerinizden bahseder misiniz?", a: "Zeynep, X alanda iş analisti olarak çalıştığını ve kariyerinde daha çok büyük ölçekli projelere dahil olmak istediğini belirtti." },
                                { q: "Önceki iş deneyimlerinizde karşılaştığınız en büyük zorluk neydi ve bu zorluğun üstesinden nasıl geldiniz?", a: "Paydaşlar arasındaki beklenti farklılıklarını yönetmenin zorlayıcı olduğunu, bu durumu düzenli toplantılar ve açık iletişimle çözdüğünü anlattı." }
                            ],
                            competencies: [
                                { name: "Analitik Düşünme", score: "Yüksek" },
                                { name: "İletişim", score: "Yüksek" },
                                { name: "Problem Çözme", score: "Orta" }
                            ],
                            secondLanguage: null,
                            missingInfo: ["Ofise gelme sıklığı", "Seyahat engeli"]
                        },
                        additionalForm: {
                            officeDays: '3 Gün',
                            travelRestriction: 'Hayır',
                            careerMotivation: 'Bu pozisyonda kendimi geliştirmek ve şirketin hedeflerine ulaşmasında aktif rol almak istiyorum.'
                        }
                    }
                ],
                // Mülakat başlatma modalındaki varsayılan yetkinlikler (CV'den gelen simülasyon)
                defaultCompetencies: ["Problem Çözme", "Teknik Bilgi"],
                
                // HiriBot'un yetkinlik bazlı sorabileceği sorular (HiriBot'un havuzu)
                AI_COMPETENCY_QUESTIONS_POOL: {
                    "Liderlik": {
                        "tr": [
                            "Bir ekibi yönettiğiniz veya bir projeye liderlik ettiğiniz bir durumu anlatın. Karşılaştığınız zorluklar nelerdi ve bunları nasıl aştınız?",
                            "Bir ekip üyesinin performansını artırması gerektiğinde nasıl bir yaklaşım sergilersiniz?",
                            "Farklı görüşlere sahip bir ekibi ortak bir hedefe nasıl yönlendirirsiniz?"
                        ],
                        "en": [
                            "Describe a situation where you managed a team or led a project. What challenges did you face and how did you overcome them?",
                            "How do you approach a situation where a team member needs to improve their performance?",
                            "How do you guide a team with differing opinions towards a common goal?"
                        ]
                    },
                    "Problem Çözme": {
                        "tr": [
                            "Karmaşık bir problemi analiz etmek ve çözmek için hangi adımları izlersiniz? Bir örnekle açıklayın.",
                            "Beklenmedik bir sorunla karşılaştığınızda, ilk tepkiniz ne olur ve çözüm sürecini nasıl başlatırsınız?",
                            "Veri eksikliği olan bir durumda nasıl karar verirsiniz?"
                        ],
                        "en": [
                            "What steps do you follow to analyze and solve a complex problem? Please explain with an example.",
                            "When faced with an unexpected problem, what is your initial reaction and how do you start the resolution process?",
                            "How do you make decisions in a situation where data is scarce?"
                        ]
                    },
                    "İletişim": {
                        "tr": [
                            "Farklı paydaşlarla (teknik olmayan kişiler, üst yönetim vb.) iletişim kurarken yaklaşımınızı nasıl ayarlarsınız?",
                            "Zor bir mesajı (örneğin, olumsuz geri bildirim) iletmeniz gerektiğinde nasıl bir strateji izlersiniz?",
                            "Aktif dinleme becerilerinizi nasıl kullanırsınız? Bir örnekle açıklayın."
                        ],
                        "en": [
                            "How do you adjust your communication style when interacting with different stakeholders (non-technical individuals, senior management, etc.)?",
                            "What strategy do you employ when you need to deliver a difficult message (e.g., negative feedback)?",
                            "How do you utilize your active listening skills? Please provide an example."
                        ]
                    },
                    "Ekip Çalışması": {
                        "tr": [
                            "Bir ekip projesinde en sevdiğiniz ve en az sevdiğiniz roller nelerdir? Neden?",
                            "Ekip içinde bir anlaşmazlık çıktığında, uzlaşmayı sağlamak için nasıl bir rol oynarsınız?",
                            "Ekip üyeleri arasında motivasyonu ve işbirliğini artırmak için neler yaparsınız?"
                        ],
                        "en": [
                            "What are your favorite and least favorite roles in a team project? Why?",
                            "When a disagreement arises within a team, what role do you play in achieving consensus?",
                            "What do you do to increase motivation and collaboration among team members?"
                        ]
                    },
                    "Adaptasyon": {
                        "tr": [
                            "Hızlı değişen bir ortamda çalışmaya nasıl adapte olursunuz? Bir örnek verebilirsiniz?",
                            "Yeni bir teknoloji veya süreç öğrenmeniz gerektiğinde nasıl bir yol izlersiniz?",
                            "Konfor alanınızın dışında bir görev üstlenmeniz gerektiğinde nasıl hissedersiniz ve nasıl hazırlanırsınız?"
                        ],
                        "en": [
                            "How do you adapt to working in a rapidly changing environment? Can you give an example?",
                            "What approach do you take when you need to learn a new technology or process?",
                            "How do you feel and prepare when you need to take on a task outside your comfort zone?"
                        ]
                    },
                    "Teknik Bilgi": {
                        "tr": [
                            "Son projenizde karşılaştığınız en karmaşık teknik sorun neydi ve bunu nasıl çözdünüz?",
                            "Hangi programlama dillerine ve framework'lere hakimsiniz? En çok hangi projelerde kullandınız?",
                            "Teknolojik gelişmeleri takip etmek için neler yaparsınız?"
                        ],
                        "en": [
                            "What was the most complex technical challenge you faced in your last project, and how did you solve it?",
                            "Which programming languages and frameworks are you proficient in? In which projects have you used them the most?",
                            "What do you do to keep up with technological advancements?"
                        ]
                    }
                },
                // HiriBot'un genel konularda sorabileceği sorular (HiriBot'un havuzu)
                AI_GENERAL_QUESTIONS_POOL: {
                    "Maaş Beklentisi": "Maaş beklentiniz nedir?",
                    "Hibrit Çalışma Uyumu": "Hibrit çalışma modelimize uyumunuz nasıl olur? Haftada kaç gün ofise gelebilirsiniz?",
                    "Seyahat Engeli": "Şehir dışı veya yurt dışı seyahat engeli bulunuyor mu?",
                    "Kariyer Motivasyonu": "Kariyerinizde sizi en çok ne motive eder ve bu pozisyonda ne gibi bir gelişim bekliyorsunuz?"
                },
                // NEW: Soru Şablonları
                questionTemplates: [
                    {
                        id: 'tpl1',
                        name: 'Yazılım Geliştirici Temel Mülakat',
                        competencies: ['Teknik Bilgi', 'Problem Çözme', 'Ekip Çalışması'],
                        generalTopics: ['Maaş Beklentisi', 'Hibrit Çalışma Uyumu'],
                        manualQuestions: ['Son 6 ayda öğrendiğiniz yeni bir teknoloji var mı?']
                    },
                    {
                        id: 'tpl2',
                        name: 'Pazarlama Uzmanı Mülakatı',
                        competencies: ['İletişim', 'Adaptasyon'],
                        generalTopics: ['Kariyer Motivasyonu'],
                        manualQuestions: ['Dijital pazarlamada en başarılı bulduğunuz kampanya nedir?']
                    }
                ]
            };

            let selectedCandidateForInterview = null; // Mülakat başlatılacak adayı tutar
            let selectedInterviewForReport = null; // Raporu görüntülenecek mülakatı tutar
            let currentSelectedCompetencies = new Set(); // Seçilen yetkinlikleri tutar (single)
            let currentSelectedGeneralTopics = new Set(); // Seçilen genel konuları tutar (single)
            let currentSelectedManualQuestions = new Set(); // Seçilen manuel soruları tutar (single)

            let bulkSelectedCandidates = new Set(); // NEW: Toplu mülakat için seçilen adayların ID'lerini tutar
            let bulkCurrentSelectedCompetencies = new Set(); // NEW: Toplu mülakat için seçilen yetkinlikler
            let bulkCurrentSelectedGeneralTopics = new Set(); // NEW: Toplu mülakat için seçilen genel konular
            let bulkCurrentSelectedManualQuestions = new Set(); // NEW: Toplu mülakat için seçilen manuel sorular


            // --- Fonksiyonlar ---

            // Bölüm değiştirme
            function showSection(sectionId) {
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');

                sidebarItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.id === `${sectionId.replace('-section', '')}-sidebar-item`) {
                        item.classList.add('active');
                    }
                });
            }

            // Tabloları render etme
            function renderCandidatesTable() {
                candidatesTableBody.innerHTML = '';
                DUMMY_DATA.candidates.forEach(candidate => {
                    // Check if candidate is already selected for bulk operation
                    const isSelected = bulkSelectedCandidates.has(candidate.id);
                    candidatesTableBody.innerHTML += `
                        <tr>
                            <td><input type="checkbox" class="candidate-checkbox h-5 w-5 text-purple-600 rounded" data-candidate-id="${candidate.id}" ${isSelected ? 'checked' : ''}></td>
                            <td>${candidate.name}</td>
                            <td>${candidate.position}</td>
                            <td><a href="${candidate.cvUrl}" target="_blank" class="text-blue-600 hover:underline">Görüntüle</a></td>
                            <td><span class="tag tag-gray">${candidate.status}</span></td>
                            <td>
                                <button class="hiri-button hiri-button-primary text-sm start-interview-btn" data-candidate-id="${candidate.id}">
                                    <i class="fas fa-video mr-2"></i>Mülakat Yap
                                </button>
                            </td>
                        </tr>
                    `;
                });
                updateBulkSelectionUI(); // Update count and button state after rendering
            }

            function updateBulkSelectionUI() {
                selectedCandidatesCountSpan.textContent = `(${bulkSelectedCandidates.size} Aday Seçili)`;
                sendBulkInterviewBtn.disabled = bulkSelectedCandidates.size === 0;
                // Update "Select All" checkbox state
                selectAllCandidatesCheckbox.checked = bulkSelectedCandidates.size === DUMMY_DATA.candidates.length && DUMMY_DATA.candidates.length > 0;
                selectAllCandidatesCheckbox.indeterminate = bulkSelectedCandidates.size > 0 && bulkSelectedCandidates.size < DUMMY_DATA.candidates.length;
            }

            function renderAllInterviewsTable() {
                allInterviewsTableBody.innerHTML = '';
                DUMMY_DATA.interviews.forEach(interview => {
                    let statusTagClass = '';
                    if (interview.status === 'Tamamlandı') statusTagClass = 'tag-green';
                    else if (interview.status === 'Başladı') statusTagClass = 'tag-blue';
                    else if (interview.status === 'Form Bekleniyor') statusTagClass = 'tag-orange';
                    else statusTagClass = 'tag-gray';

                    allInterviewsTableBody.innerHTML += `
                        <tr>
                            <td>${interview.candidateName}</td>
                            <td>${interview.position}</td>
                            <td><span class="tag ${statusTagClass}">${interview.status}</span></td>
                            <td>${interview.startDate}</td>
                            <td>${interview.endDate || '-'}</td>
                            <td>
                                ${interview.status === 'Tamamlandı' || interview.status === 'Form Bekleniyor' ? 
                                `<button class="hiri-button hiri-button-secondary text-sm view-report-btn" data-interview-id="${interview.id}">
                                    <i class="fas fa-file-alt mr-2"></i>Rapor
                                </button>` : '-'}
                            </td>
                        </tr>
                    `;
                });
            }

            function renderReportsTable() {
                reportsTableBody.innerHTML = '';
                const completedInterviews = DUMMY_DATA.interviews.filter(i => i.status === 'Tamamlandı' || i.status === 'Form Bekleniyor');
                if (completedInterviews.length === 0) {
                    reportsTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-slate-500 py-4">Henüz tamamlanmış mülakat raporu bulunmamaktadır.</td></tr>`;
                    return;
                }
                completedInterviews.forEach(interview => {
                    reportsTableBody.innerHTML += `
                        <tr>
                            <td>${interview.candidateName}</td>
                            <td>${interview.position}</td>
                            <td>${interview.report ? interview.report.score + '/100' : '-'}</td>
                            <td>${interview.endDate || '-'}</td>
                            <td>
                                <button class="hiri-button hiri-button-secondary text-sm view-report-btn" data-interview-id="${interview.id}">
                                    <i class="fas fa-file-alt mr-2"></i>Raporu Görüntüle
                                </button>
                                ${interview.additionalForm ? 
                                    `<button class="hiri-button hiri-button-secondary text-sm view-form-data-btn ml-2" data-interview-id="${interview.id}">
                                        <i class="fas fa-clipboard-list mr-2"></i>Form Yanıtları
                                    </button>` : ''}
                            </td>
                        </tr>
                    `;
                });
            }

            function renderLatestInterviewsTable() {
                latestInterviewsTableBody.innerHTML = '';
                const latest = DUMMY_DATA.interviews.slice(0, 5); // Son 5 mülakat
                if (latest.length === 0) {
                    latestInterviewsTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-slate-500 py-4">Henüz mülakat başlatılmadı.</td></tr>`;
                    return;
                }
                latest.forEach(interview => {
                    let statusTagClass = '';
                    if (interview.status === 'Tamamlandı') statusTagClass = 'tag-green';
                    else if (interview.status === 'Başladı') statusTagClass = 'tag-blue';
                    else if (interview.status === 'Form Bekleniyor') statusTagClass = 'tag-orange';
                    else statusTagClass = 'tag-gray';

                    latestInterviewsTableBody.innerHTML += `
                        <tr>
                            <td>${interview.candidateName}</td>
                            <td>${interview.position}</td>
                            <td><span class="tag ${statusTagClass}">${interview.status}</span></td>
                            <td>${interview.startDate}</td>
                            <td>
                                ${interview.status === 'Tamamlandı' || interview.status === 'Form Bekleniyor' ? 
                                `<button class="hiri-button hiri-button-secondary text-sm view-report-btn" data-interview-id="${interview.id}">
                                    <i class="fas fa-file-alt"></i>
                                </button>` : '-'}
                            </td>
                        </tr>
                    `;
                });
            }

            // Seçilen yetkinlikleri/konuları önizleme alanına ekle/kaldır (Single Interview)
            function updateSelectedCompetenciesPreview(isBulk = false) {
                const previewEl = isBulk ? bulkSelectedCompetenciesPreview : selectedCompetenciesPreview;
                const selectedSet = isBulk ? bulkCurrentSelectedCompetencies : currentSelectedCompetencies;

                if (selectedSet.size === 0) {
                    previewEl.innerHTML = '<p>Seçilen yetkinlikler: Yok</p>';
                } else {
                    previewEl.innerHTML = '<p>Seçilen yetkinlikler:</p><ul>' + 
                        Array.from(selectedSet).map(comp => `<li>${comp}</li>`).join('') + 
                        '</ul>';
                }
            }

            function updateSelectedGeneralInfoPreview(isBulk = false) {
                const previewEl = isBulk ? bulkSelectedGeneralInfoPreview : selectedGeneralInfoPreview;
                const selectedSet = isBulk ? bulkCurrentSelectedGeneralTopics : currentSelectedGeneralTopics;

                if (selectedSet.size === 0) {
                    previewEl.innerHTML = '<p>Seçilen konular: Yok</p>';
                } else {
                    previewEl.innerHTML = '<p>Seçilen konular:</p><ul>' + 
                        Array.from(selectedSet).map(topic => `<li>${topic}</li>`).join('') + 
                        '</ul>';
                }
            }

            function updateSelectedManualQuestionsPreview(isBulk = false) {
                const previewEl = isBulk ? bulkSelectedManualQuestionsPreview : selectedManualQuestionsPreview;
                const selectedSet = isBulk ? bulkCurrentSelectedManualQuestions : currentSelectedManualQuestions;

                if (selectedSet.size === 0) {
                    previewEl.innerHTML = '<p>Eklenen manuel sorular: Yok</p>';
                } else {
                    previewEl.innerHTML = '<p>Eklenen manuel sorular:</p><ul>' + 
                        Array.from(selectedSet).map(q => `<li>${q}</li>`).join('') + 
                        '</ul>';
                }
            }

            // NEW: Tüm seçimleri temizleme fonksiyonu
            function clearAllSelections(isBulk = false) {
                const competenciesSet = isBulk ? bulkCurrentSelectedCompetencies : currentSelectedCompetencies;
                const generalTopicsSet = isBulk ? bulkCurrentSelectedGeneralTopics : currentSelectedGeneralTopics;
                const manualQuestionsSet = isBulk ? bulkCurrentSelectedManualQuestions : currentSelectedManualQuestions;
                const competencyTagsToClear = isBulk ? bulkCompetencyTags : competencyTags;
                const generalInfoTagsToClear = isBulk ? generalInfoTags : generalInfoTags;
                const manualQuestionInputToClear = isBulk ? bulkManualCustomQuestionInput : manualCustomQuestionInput;

                competenciesSet.clear();
                generalTopicsSet.clear();
                manualQuestionsSet.clear();

                competencyTagsToClear.forEach(tag => tag.classList.remove('selected'));
                generalInfoTagsToClear.forEach(tag => tag.classList.remove('selected'));
                if (manualQuestionInputToClear) manualQuestionInputToClear.value = '';

                updateSelectedCompetenciesPreview(isBulk);
                updateSelectedGeneralInfoPreview(isBulk);
                updateSelectedManualQuestionsPreview(isBulk);
            }

            // NEW: Şablonları yükle dropdown'ını güncelleme
            function populateTemplateSelects() {
                loadTemplateSelect.innerHTML = '<option value="">Şablon Seçiniz</option>';
                bulkLoadTemplateSelect.innerHTML = '<option value="">Şablon Seçiniz</option>';

                if (DUMMY_DATA.questionTemplates.length > 0) {
                    loadTemplateBtn.disabled = false;
                    bulkLoadTemplateBtn.disabled = false;
                    DUMMY_DATA.questionTemplates.forEach(template => {
                        const option = `<option value="${template.id}">${template.name}</option>`;
                        loadTemplateSelect.innerHTML += option;
                        bulkLoadTemplateSelect.innerHTML += option;
                    });
                } else {
                    loadTemplateBtn.disabled = true;
                    bulkLoadTemplateBtn.disabled = true;
                }
            }

            // NEW: Şablon yükleme fonksiyonu
            function loadTemplate(templateId, isBulk = false) {
                const template = DUMMY_DATA.questionTemplates.find(tpl => tpl.id === templateId);
                if (!template) return;

                clearAllSelections(isBulk); // Önce mevcut seçimleri temizle

                const competenciesSet = isBulk ? bulkCurrentSelectedCompetencies : currentSelectedCompetencies;
                const generalTopicsSet = isBulk ? bulkCurrentSelectedGeneralTopics : currentSelectedGeneralTopics;
                const manualQuestionsSet = isBulk ? bulkCurrentSelectedManualQuestions : currentSelectedManualQuestions;
                const competencyTagsToUpdate = isBulk ? bulkCompetencyTags : competencyTags;
                const generalInfoTagsToUpdate = isBulk ? generalInfoTags : generalInfoTags;

                template.competencies.forEach(comp => {
                    competenciesSet.add(comp);
                    const tag = (isBulk ? bulkCompetencySelectionGroup : competencySelectionGroup).querySelector(`[data-competency="${comp}"]`);
                    if (tag) tag.classList.add('selected');
                });

                template.generalTopics.forEach(topic => {
                    generalTopicsSet.add(topic);
                    const tag = (isBulk ? bulkGeneralInfoSelectionGroup : generalInfoSelectionGroup).querySelector(`[data-topic="${topic}"]`);
                    if (tag) tag.classList.add('selected');
                });

                template.manualQuestions.forEach(q => {
                    manualQuestionsSet.add(q);
                });

                updateSelectedCompetenciesPreview(isBulk);
                updateSelectedGeneralInfoPreview(isBulk);
                updateSelectedManualQuestionsPreview(isBulk);

                alert(`${template.name} şablonu başarıyla yüklendi!`);
            }

            // Mülakat Kurulum Modalını Aç (Single Interview)
            function openInterviewSetupModal(candidateId) {
                selectedCandidateForInterview = DUMMY_DATA.candidates.find(c => c.id === candidateId);
                if (!selectedCandidateForInterview) return;

                setupCandidateName.textContent = selectedCandidateForInterview.name;
                setupCandidatePosition.textContent = selectedCandidateForInterview.position;

                clearAllSelections(false); // Önceki seçimleri temizle
                
                // Varsayılan yetkinlikleri seç (simülasyon: pozisyona göre otomatik seçili gelebilir)
                DUMMY_DATA.defaultCompetencies.forEach(comp => {
                    const tag = competencySelectionGroup.querySelector(`[data-competency="${comp}"]`);
                    if (tag) {
                        tag.classList.add('selected');
                        currentSelectedCompetencies.add(comp);
                    }
                });

                // Mülakat dili ve ikinci dil değerlendirme varsayılanlarını ayarla
                interviewLanguageSelect.value = 'tr'; // Varsayılan Türkçe
                assessSecondLanguageCheckbox.checked = false; // Varsayılan olarak kapalı

                updateSelectedCompetenciesPreview();
                updateSelectedGeneralInfoPreview();
                updateSelectedManualQuestionsPreview();
                manualCustomQuestionInput.value = '';
                populateTemplateSelects(); // Şablonları yükle dropdown'ını güncelle

                interviewSetupModal.classList.add('is-open');
            }

            // Mülakat Kurulum Modalını Kapat (Single Interview)
            function closeInterviewSetupModal() {
                interviewSetupModal.classList.remove('is-open');
                selectedCandidateForInterview = null;
            }

            // NEW: Open Bulk Interview Setup Modal
            function openBulkInterviewSetupModal() {
                if (bulkSelectedCandidates.size === 0) {
                    alert('Lütfen toplu mülakat göndermek için aday seçin.');
                    return;
                }
                bulkCandidateCountSpan.textContent = bulkSelectedCandidates.size;

                clearAllSelections(true); // Önceki seçimleri temizle (bulk için)

                // Apply default competencies for bulk (or load from a saved template if available)
                DUMMY_DATA.defaultCompetencies.forEach(comp => {
                    const tag = bulkCompetencySelectionGroup.querySelector(`[data-competency="${comp}"]`);
                    if (tag) {
                        tag.classList.add('selected');
                        bulkCurrentSelectedCompetencies.add(comp);
                    }
                });

                bulkInterviewLanguageSelect.value = 'tr';
                bulkAssessSecondLanguageCheckbox.checked = false;

                updateSelectedCompetenciesPreview(true);
                updateSelectedGeneralInfoPreview(true);
                updateSelectedManualQuestionsPreview(true);
                bulkManualCustomQuestionInput.value = '';
                populateTemplateSelects(); // Şablonları yükle dropdown'ını güncelle (bulk için)

                bulkInterviewSetupModal.classList.add('is-open');
            }

            // NEW: Close Bulk Interview Setup Modal
            function closeBulkInterviewSetupModal() {
                bulkInterviewSetupModal.classList.remove('is-open');
            }


            // Mülakat Rapor Modalını Aç
            function openInterviewReportModal(interviewId) {
                selectedInterviewForReport = DUMMY_DATA.interviews.find(i => i.id === interviewId);
                if (!selectedInterviewForReport || !selectedInterviewForReport.report) return;

                reportCandidateName.textContent = selectedInterviewForReport.candidateName;
                reportSummary.textContent = selectedInterviewForReport.report.summary;
                reportScore.textContent = selectedInterviewForReport.report.score + '/100';

                reportQaList.innerHTML = '';
                selectedInterviewForReport.report.qa.forEach(item => {
                    reportQaList.innerHTML += `<p><strong>Soru:</strong> ${item.q}</p><p class="mb-3"><strong>Yanıt:</strong> ${item.a}</p>`;
                });

                reportCompetencyList.innerHTML = '';
                selectedInterviewForReport.report.competencies.forEach(comp => {
                    reportCompetencyList.innerHTML += `<li><strong>${comp.name}:</strong> ${comp.score}</li>`;
                });

                // İkinci Dil Yetkinliği bölümünü göster/gizle ve doldur
                if (selectedInterviewForReport.report.secondLanguage) {
                    reportSecondLanguageSection.classList.remove('hidden');
                    reportSecondLanguageScore.textContent = selectedInterviewForReport.report.secondLanguage.score;
                    reportSecondLanguageSummary.textContent = selectedInterviewForReport.report.secondLanguage.summary;
                } else {
                    reportSecondLanguageSection.classList.add('hidden');
                }

                if (selectedInterviewForReport.report.missingInfo && selectedInterviewForReport.report.missingInfo.length > 0) {
                    reportMissingInfoSection.classList.remove('hidden');
                    reportMissingInfoList.innerHTML = '';
                    selectedInterviewForReport.report.missingInfo.forEach(info => {
                        reportMissingInfoList.innerHTML += `<li>${info}</li>`;
                    });
                    sendAdditionalFormBtn.classList.remove('hidden'); // Form gönder butonu görünür
                } else {
                    reportMissingInfoSection.classList.add('hidden');
                    sendAdditionalFormBtn.classList.add('hidden'); // Form gönder butonu gizli
                }

                // Eğer form zaten gönderilmişse, "Ek Form Gönder" butonunu devre dışı bırak
                if (selectedInterviewForReport.additionalForm) {
                    sendAdditionalFormBtn.textContent = 'Ek Form Gönderildi';
                    sendAdditionalFormBtn.disabled = true;
                    sendAdditionalFormBtn.classList.remove('hiri-button-primary');
                    sendAdditionalFormBtn.classList.add('hiri-button-secondary');
                } else {
                    sendAdditionalFormBtn.textContent = 'Ek Form Gönder';
                    sendAdditionalFormBtn.disabled = false;
                    sendAdditionalFormBtn.classList.remove('hiri-button-secondary');
                    sendAdditionalFormBtn.classList.add('hiri-button-primary');
                }

                interviewReportModal.classList.add('is-open');
            }

            // Mülakat Rapor Modalını Kapat
            function closeInterviewReportModal() {
                interviewReportModal.classList.remove('is-open');
                selectedInterviewForReport = null;
            }

            // Ek Bilgi Formu Yanıtlarını Görüntüle Modalını Aç
            function openAdditionalFormViewModal(interviewId) {
                const interview = DUMMY_DATA.interviews.find(i => i.id === interviewId);
                if (!interview || !interview.additionalForm) return;

                formViewCandidateName.textContent = interview.candidateName;
                formViewOfficeDays.textContent = interview.additionalForm.officeDays;
                formViewTravelRestriction.textContent = interview.additionalForm.travelRestriction === 'yes' ? 'Evet' : 'Hayır';
                formViewCareerMotivation.textContent = interview.additionalForm.careerMotivation;

                additionalFormViewModal.classList.add('is-open');
            }

            // Ek Bilgi Formu Yanıtlarını Görüntüle Modalını Kapat
            function closeAdditionalFormViewModal() {
                additionalFormViewModal.classList.remove('is-open');
            }

            // --- Event Listeners ---

            // Sidebar navigasyon
            sidebarItems.forEach(item => {
                item.addEventListener('click', () => {
                    const sectionId = item.id.replace('-sidebar-item', '-section');
                    showSection(sectionId);
                    // Her section değiştiğinde ilgili tabloları yeniden render et
                    if (sectionId === 'candidates-section') renderCandidatesTable();
                    if (sectionId === 'interviews-section') renderAllInterviewsTable();
                    if (sectionId === 'reports-section') renderReportsTable();
                    if (sectionId === 'dashboard-section') renderLatestInterviewsTable(); // Dashboard'a dönünce son mülakatları güncelle
                });
            });

            // Aday tablosundaki "Mülakat Yap" butonları (Single Interview)
            document.addEventListener('click', (e) => {
                if (e.target.closest('.start-interview-btn')) {
                    const candidateId = e.target.closest('.start-interview-btn').dataset.candidateId;
                    openInterviewSetupModal(candidateId);
                }
            });

            // Mülakat Kurulum Modal butonları (Single Interview)
            closeSetupModalBtn.addEventListener('click', closeInterviewSetupModal);
            cancelSetupBtn.addEventListener('click', closeInterviewSetupModal);

            // Yetkinlik etiketlerine tıklama (Single Interview)
            competencySelectionGroup.addEventListener('click', (e) => {
                const tag = e.target.closest('.competency-tag');
                if (tag) {
                    const competency = tag.dataset.competency;
                    tag.classList.toggle('selected');
                    if (tag.classList.contains('selected')) {
                        currentSelectedCompetencies.add(competency);
                    } else {
                        currentSelectedCompetencies.delete(competency);
                    }
                    updateSelectedCompetenciesPreview();
                }
            });

            // Genel bilgi etiketlerine tıklama (Single Interview)
            generalInfoSelectionGroup.addEventListener('click', (e) => {
                const tag = e.target.closest('.general-info-tag');
                if (tag) {
                    const topic = tag.dataset.topic;
                    tag.classList.toggle('selected');
                    if (tag.classList.contains('selected')) {
                        currentSelectedGeneralTopics.add(topic);
                    } else {
                        currentSelectedGeneralTopics.delete(topic);
                    }
                    updateSelectedGeneralInfoPreview();
                }
            });

            // Manuel Ek Soru Ekle butonu (Single Interview)
            addManualCustomQuestionBtn.addEventListener('click', () => {
                const customQ = manualCustomQuestionInput.value.trim();
                if (customQ) {
                    currentSelectedManualQuestions.add(customQ);
                    updateSelectedManualQuestionsPreview();
                    manualCustomQuestionInput.value = '';
                }
            });

            // NEW: Şablon Olarak Kaydet butonu (Single Interview)
            saveTemplateBtn.addEventListener('click', () => {
                const templateName = prompt('Şablon için bir isim girin:');
                if (templateName) {
                    const newTemplate = {
                        id: 'tpl' + Date.now(),
                        name: templateName,
                        competencies: Array.from(currentSelectedCompetencies),
                        generalTopics: Array.from(currentSelectedGeneralTopics),
                        manualQuestions: Array.from(currentSelectedManualQuestions)
                    };
                    DUMMY_DATA.questionTemplates.push(newTemplate);
                    populateTemplateSelects(); // Dropdown'ları güncelle
                    alert(`"${templateName}" şablonu başarıyla kaydedildi!`);
                }
            });

            // NEW: Şablon Yükle butonu (Single Interview)
            loadTemplateBtn.addEventListener('click', () => {
                const selectedTemplateId = loadTemplateSelect.value;
                if (selectedTemplateId) {
                    loadTemplate(selectedTemplateId, false);
                } else {
                    alert('Lütfen yüklenecek bir şablon seçin.');
                }
            });

            // Start Single Interview Process
            startInterviewProcessBtn.addEventListener('click', () => {
                if (!selectedCandidateForInterview) return;

                const interviewLanguage = interviewLanguageSelect.value;
                const assessSecondLanguage = assessSecondLanguageCheckbox.checked;

                const interviewScope = {
                    competencies: Array.from(currentSelectedCompetencies),
                    generalTopics: Array.from(currentSelectedGeneralTopics),
                    manualQuestions: Array.from(currentSelectedManualQuestions),
                    interviewLanguage: interviewLanguage,
                    assessSecondLanguage: assessSecondLanguage
                };
                
                const newInterview = {
                    id: 'i' + Date.now(),
                    candidateId: selectedCandidateForInterview.id,
                    candidateName: selectedCandidateForInterview.name,
                    position: selectedCandidateForInterview.position,
                    status: 'Başladı',
                    startDate: new Date().toLocaleString('tr-TR'),
                    endDate: null,
                    report: null,
                    additionalForm: null,
                    interviewScope: interviewScope
                };
                DUMMY_DATA.interviews.unshift(newInterview);

                const candidateIndex = DUMMY_DATA.candidates.findIndex(c => c.id === selectedCandidateForInterview.id);
                if (candidateIndex > -1) {
                    DUMMY_DATA.candidates[candidateIndex].status = 'Mülakatta';
                }

                closeInterviewSetupModal();
                renderAllInterviewsTable();
                renderCandidatesTable();
                renderLatestInterviewsTable();
                showSection('interviews-section');

                // Simulate interview completion
                setTimeout(() => {
                    const interviewToUpdate = DUMMY_DATA.interviews.find(i => i.id === newInterview.id);
                    if (interviewToUpdate) {
                        interviewToUpdate.status = 'Tamamlandı';
                        interviewToUpdate.endDate = new Date().toLocaleString('tr-TR');
                        
                        const simulatedQA = [];
                        const lang = interviewToUpdate.interviewScope.interviewLanguage;

                        interviewToUpdate.interviewScope.competencies.forEach(comp => {
                            const sampleQuestion = DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp] && DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp][lang] ? DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp][lang][0] : `[${comp} yetkinliği ile ilgili soru (${lang})]`;
                            simulatedQA.push({ q: sampleQuestion, a: `${interviewToUpdate.candidateName}, ${comp} yetkinliği hakkında yanıt verdi.` });
                        });
                        interviewToUpdate.interviewScope.generalTopics.forEach(topic => {
                            const sampleQuestion = DUMMY_DATA.AI_GENERAL_QUESTIONS_POOL[topic] || `[${topic} ile ilgili soru]`;
                            simulatedQA.push({ q: sampleQuestion, a: `${interviewToUpdate.candidateName}, ${topic} hakkında bilgi verdi.` });
                        });
                        interviewToUpdate.interviewScope.manualQuestions.forEach(q => {
                            simulatedQA.push({ q: q, a: `${interviewToUpdate.candidateName}, manuel soruya yanıt verdi.` });
                        });

                        let simulatedSecondLanguageScore = null;
                        if (interviewToUpdate.interviewScope.assessSecondLanguage) {
                            const englishQuestions = DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL["İletişim"]["en"].slice(0,2);
                            englishQuestions.forEach(q => {
                                simulatedQA.push({ q: `(English) ${q}`, a: `${interviewToUpdate.candidateName} answered in English.` });
                            });
                            const scores = ["A2 (Beginner)", "B1 (Intermediate)", "B2 (Upper-Intermediate)", "C1 (Advanced)", "C2 (Proficient)"];
                            const summaries = [
                                "Adayın İngilizce temel seviyede. Basit cümleler kurabiliyor ancak akıcılık ve kelime dağarcığı sınırlı.",
                                "Adayın İngilizce orta seviyede. Günlük konuşmaları anlayabiliyor ve kendini ifade edebiliyor.",
                                "Adayın İngilizce akıcılığı iyi seviyede. Karmaşık konularda rahatça iletişim kurabiliyor.",
                                "Adayın İngilizce çok iyi seviyede. Neredeyse anadili gibi konuşabiliyor, akademik ve profesyonel ortamlara uygun.",
                                "Adayın İngilizce anadil seviyesinde. Her türlü konuda akıcı ve hatasız iletişim kurabiliyor."
                            ];
                            const randomScoreIndex = Math.floor(Math.random() * scores.length);
                            simulatedSecondLanguageScore = {
                                score: scores[randomScoreIndex],
                                summary: summaries[randomScoreIndex]
                            };
                        }

                        interviewToUpdate.report = {
                            summary: `${interviewToUpdate.candidateName}, HiriBot mülakatını başarıyla tamamladı. Genel performansı olumlu. Mülakat dili: ${lang === 'tr' ? 'Türkçe' : 'İngilizce'}. Seçilen yetkinlikler ve konular (${interviewToUpdate.interviewScope.competencies.join(', ')}; ${interviewToUpdate.interviewScope.generalTopics.join(', ')}) kapsamında değerlendirilmiştir.`,
                            score: Math.floor(Math.random() * 20) + 70,
                            qa: simulatedQA,
                            competencies: interviewToUpdate.interviewScope.competencies.map(comp => ({ name: comp, score: ["Yüksek", "Orta", "Düşük"][Math.floor(Math.random()*3)] })),
                            secondLanguage: simulatedSecondLanguageScore,
                            missingInfo: Math.random() > 0.5 ? ["Ek bilgi 1", "Ek bilgi 2"] : []
                        };
                        renderAllInterviewsTable();
                        renderReportsTable();
                        renderLatestInterviewsTable();
                        alert(`${interviewToUpdate.candidateName} adlı adayın HiriBot mülakatı tamamlandı! Raporu inceleyebilirsiniz.`);
                    }
                }, 10000);
            });

            // Rapor Görüntüle butonları
            document.addEventListener('click', (e) => {
                if (e.target.closest('.view-report-btn')) {
                    const interviewId = e.target.closest('.view-report-btn').dataset.interviewId;
                    openInterviewReportModal(interviewId);
                }
            });

            // Rapor Modal butonları
            closeReportModalBtn.addEventListener('click', closeInterviewReportModal);
            closeReportFinalBtn.addEventListener('click', closeInterviewReportModal);

            sendAdditionalFormBtn.addEventListener('click', () => {
                if (!selectedInterviewForReport) return;

                selectedInterviewForReport.status = 'Form Bekleniyor';
                selectedInterviewForReport.additionalForm = {
                    officeDays: ['1 Gün', '2 Gün', '3 Gün', '4 Gün', '5 Gün (Tam zamanlı ofis)', 'Tamamen Uzaktan'][Math.floor(Math.random() * 6)],
                    travelRestriction: Math.random() > 0.5 ? 'yes' : 'no',
                    careerMotivation: 'Bu pozisyonda kendimi geliştirmek ve şirketin hedeflerine ulaşmasında aktif rol almak istiyorum.'
                };
                
                renderAllInterviewsTable();
                renderReportsTable();
                alert(`Ek bilgi formu ${selectedInterviewForReport.candidateName} adlı adaya gönderildi.`);
                closeInterviewReportModal();
            });

            // Form Yanıtları Görüntüle butonları
            document.addEventListener('click', (e) => {
                if (e.target.closest('.view-form-data-btn')) {
                    const interviewId = e.target.closest('.view-form-data-btn').dataset.interviewId;
                    openAdditionalFormViewModal(interviewId);
                }
            });

            // Form Yanıtları Görüntüle Modal butonları
            closeFormViewModalBtn.addEventListener('click', closeAdditionalFormViewModal);
            closeFormViewFinalBtn.addEventListener('click', closeAdditionalFormViewModal);

            // --- NEW: Bulk Operations Logic ---

            // Candidate checkbox selection
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('candidate-checkbox')) {
                    const candidateId = e.target.dataset.candidateId;
                    if (e.target.checked) {
                        bulkSelectedCandidates.add(candidateId);
                    } else {
                        bulkSelectedCandidates.delete(candidateId);
                    }
                    updateBulkSelectionUI();
                }
            });

            // Select All checkbox
            selectAllCandidatesCheckbox.addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                document.querySelectorAll('.candidate-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                    const candidateId = checkbox.dataset.candidateId;
                    if (isChecked) {
                        bulkSelectedCandidates.add(candidateId);
                    } else {
                        bulkSelectedCandidates.delete(candidateId);
                    }
                });
                updateBulkSelectionUI();
            });

            // Open Bulk Interview Setup Modal
            sendBulkInterviewBtn.addEventListener('click', openBulkInterviewSetupModal);
            closeBulkSetupModalBtn.addEventListener('click', closeBulkInterviewSetupModal);
            bulkCancelSetupBtn.addEventListener('click', closeBulkInterviewSetupModal);

            // Bulk Competency Tags
            bulkCompetencySelectionGroup.addEventListener('click', (e) => {
                const tag = e.target.closest('.competency-tag');
                if (tag) {
                    const competency = tag.dataset.competency;
                    tag.classList.toggle('selected');
                    if (tag.classList.contains('selected')) {
                        bulkCurrentSelectedCompetencies.add(competency);
                    } else {
                        bulkCurrentSelectedCompetencies.delete(competency);
                    }
                    updateSelectedCompetenciesPreview(true);
                }
            });

            // Bulk General Info Tags
            bulkGeneralInfoSelectionGroup.addEventListener('click', (e) => {
                const tag = e.target.closest('.general-info-tag');
                if (tag) {
                    const topic = tag.dataset.topic;
                    tag.classList.toggle('selected');
                    if (tag.classList.contains('selected')) {
                        bulkCurrentSelectedGeneralTopics.add(topic);
                    } else {
                        bulkCurrentSelectedGeneralTopics.delete(topic);
                    }
                    updateSelectedGeneralInfoPreview(true);
                }
            });

            // Bulk Manual Custom Question
            bulkAddManualCustomQuestionBtn.addEventListener('click', () => {
                const customQ = bulkManualCustomQuestionInput.value.trim();
                if (customQ) {
                    bulkCurrentSelectedManualQuestions.add(customQ);
                    updateSelectedManualQuestionsPreview(true);
                    bulkManualCustomQuestionInput.value = '';
                }
            });

            // NEW: Şablon Olarak Kaydet butonu (Bulk Interview)
            bulkSaveTemplateBtn.addEventListener('click', () => {
                const templateName = prompt('Şablon için bir isim girin:');
                if (templateName) {
                    const newTemplate = {
                        id: 'tpl' + Date.now(),
                        name: templateName,
                        competencies: Array.from(bulkCurrentSelectedCompetencies),
                        generalTopics: Array.from(bulkCurrentSelectedGeneralTopics),
                        manualQuestions: Array.from(bulkCurrentSelectedManualQuestions)
                    };
                    DUMMY_DATA.questionTemplates.push(newTemplate);
                    populateTemplateSelects(); // Dropdown'ları güncelle
                    alert(`"${templateName}" şablonu başarıyla kaydedildi!`);
                }
            });

            // NEW: Şablon Yükle butonu (Bulk Interview)
            bulkLoadTemplateBtn.addEventListener('click', () => {
                const selectedTemplateId = bulkLoadTemplateSelect.value;
                if (selectedTemplateId) {
                    loadTemplate(selectedTemplateId, true);
                } else {
                    alert('Lütfen yüklenecek bir şablon seçin.');
                }
            });

            // Start Bulk Interview Process
            bulkStartInterviewProcessBtn.addEventListener('click', () => {
                if (bulkSelectedCandidates.size === 0) {
                    alert('Lütfen toplu mülakat göndermek için aday seçin.');
                    return;
                }

                const bulkInterviewLanguage = bulkInterviewLanguageSelect.value;
                const bulkAssessSecondLanguage = bulkAssessSecondLanguageCheckbox.checked;

                const bulkInterviewScope = {
                    competencies: Array.from(bulkCurrentSelectedCompetencies),
                    generalTopics: Array.from(bulkCurrentSelectedGeneralTopics),
                    manualQuestions: Array.from(bulkCurrentSelectedManualQuestions),
                    interviewLanguage: bulkInterviewLanguage,
                    assessSecondLanguage: bulkAssessSecondLanguage
                };

                const candidatesToInterview = Array.from(bulkSelectedCandidates).map(candidateId => 
                    DUMMY_DATA.candidates.find(c => c.id === candidateId)
                );

                candidatesToInterview.forEach(candidate => {
                    if (candidate) {
                        const newInterview = {
                            id: 'i' + Date.now() + Math.random().toString(36).substr(2, 9), // More unique ID
                            candidateId: candidate.id,
                            candidateName: candidate.name,
                            position: candidate.position,
                            status: 'Başladı',
                            startDate: new Date().toLocaleString('tr-TR'),
                            endDate: null,
                            report: null,
                            additionalForm: null,
                            interviewScope: bulkInterviewScope // Apply bulk settings
                        };
                        DUMMY_DATA.interviews.unshift(newInterview);

                        const candidateIndex = DUMMY_DATA.candidates.findIndex(c => c.id === candidate.id);
                        if (candidateIndex > -1) {
                            DUMMY_DATA.candidates[candidateIndex].status = 'Mülakatta';
                        }

                        // Simulate interview completion for each bulk candidate
                        setTimeout(() => {
                            const interviewToUpdate = DUMMY_DATA.interviews.find(i => i.id === newInterview.id);
                            if (interviewToUpdate) {
                                interviewToUpdate.status = 'Tamamlandı';
                                interviewToUpdate.endDate = new Date().toLocaleString('tr-TR');
                                
                                const simulatedQA = [];
                                const lang = interviewToUpdate.interviewScope.interviewLanguage;

                                interviewToUpdate.interviewScope.competencies.forEach(comp => {
                                    const sampleQuestion = DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp] && DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp][lang] ? DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL[comp][lang][0] : `[${comp} yetkinliği ile ilgili soru (${lang})]`;
                                    simulatedQA.push({ q: sampleQuestion, a: `${interviewToUpdate.candidateName}, ${comp} yetkinliği hakkında yanıt verdi.` });
                                });
                                interviewToUpdate.interviewScope.generalTopics.forEach(topic => {
                                    const sampleQuestion = DUMMY_DATA.AI_GENERAL_QUESTIONS_POOL[topic] || `[${topic} ile ilgili soru]`;
                                    simulatedQA.push({ q: sampleQuestion, a: `${interviewToUpdate.candidateName}, ${topic} hakkında bilgi verdi.` });
                                });
                                interviewToUpdate.interviewScope.manualQuestions.forEach(q => {
                                    simulatedQA.push({ q: q, a: `${interviewToUpdate.candidateName}, manuel soruya yanıt verdi.` });
                                });

                                let simulatedSecondLanguageScore = null;
                                if (interviewToUpdate.interviewScope.assessSecondLanguage) {
                                    const englishQuestions = DUMMY_DATA.AI_COMPETENCY_QUESTIONS_POOL["İletişim"]["en"].slice(0,2);
                                    englishQuestions.forEach(q => {
                                        simulatedQA.push({ q: `(English) ${q}`, a: `${interviewToUpdate.candidateName} answered in English.` });
                                    });
                                    const scores = ["A2 (Beginner)", "B1 (Intermediate)", "B2 (Upper-Intermediate)", "C1 (Advanced)", "C2 (Proficient)"];
                                    const summaries = [
                                        "Adayın İngilizce temel seviyede. Basit cümleler kurabiliyor ancak akıcılık ve kelime dağarcığı sınırlı.",
                                        "Adayın İngilizce orta seviyede. Günlük konuşmaları anlayabiliyor ve kendini ifade edebiliyor.",
                                        "Adayın İngilizce akıcılığı iyi seviyede. Karmaşık konularda rahatça iletişim kurabiliyor.",
                                        "Adayın İngilizce çok iyi seviyede. Neredeyse anadili gibi konuşabiliyor, akademik ve profesyonel ortamlara uygun.",
                                        "Adayın İngilizce anadil seviyesinde. Her türlü konuda akıcı ve hatasız iletişim kurabiliyor."
                                    ];
                                    const randomScoreIndex = Math.floor(Math.random() * scores.length);
                                    simulatedSecondLanguageScore = {
                                        score: scores[randomScoreIndex],
                                        summary: summaries[randomScoreIndex]
                                    };
                                }

                                interviewToUpdate.report = {
                                    summary: `${interviewToUpdate.candidateName}, HiriBot mülakatını başarıyla tamamladı. Genel performansı olumlu. Mülakat dili: ${lang === 'tr' ? 'Türkçe' : 'İngilizce'}. Seçilen yetkinlikler ve konular (${interviewToUpdate.interviewScope.competencies.join(', ')}; ${interviewToUpdate.interviewScope.generalTopics.join(', ')}) kapsamında değerlendirilmiştir.`,
                                    score: Math.floor(Math.random() * 20) + 70,
                                    qa: simulatedQA,
                                    competencies: interviewToUpdate.interviewScope.competencies.map(comp => ({ name: comp, score: ["Yüksek", "Orta", "Düşük"][Math.floor(Math.random()*3)] })),
                                    secondLanguage: simulatedSecondLanguageScore,
                                    missingInfo: Math.random() > 0.5 ? ["Ek bilgi 1", "Ek bilgi 2"] : []
                                };
                                renderAllInterviewsTable();
                                renderReportsTable();
                                renderLatestInterviewsTable();
                                // alert(`${interviewToUpdate.candidateName} adlı adayın HiriBot mülakatı tamamlandı! Raporu inceleyebilirsiniz.`); // Too many alerts for bulk
                            }
                        }, 5000 + Math.random() * 5000); // Simulate staggered completion for bulk
                    }
                });

                alert(`${bulkSelectedCandidates.size} adaya toplu mülakat daveti gönderildi! Mülakatlar tamamlandıkça raporlarını görüntüleyebilirsiniz.`);
                closeBulkInterviewSetupModal();
                bulkSelectedCandidates.clear(); // Clear selection after sending
                renderCandidatesTable(); // Re-render candidates table to clear checkboxes
                showSection('interviews-section'); // Navigate to interviews section
            });


            // --- İlk Render ---
            // Sayfa yüklendiğinde varsayılan olarak seçili yetkinlikleri güncelle
            updateSelectedCompetenciesPreview();
            updateSelectedGeneralInfoPreview();
            updateSelectedManualQuestionsPreview();

            // Initial render for bulk modal previews
            updateSelectedCompetenciesPreview(true);
            updateSelectedGeneralInfoPreview(true);
            updateSelectedManualQuestionsPreview(true);

            populateTemplateSelects(); // Sayfa yüklendiğinde şablon dropdown'larını doldur

            renderCandidatesTable();
            renderAllInterviewsTable();
            renderReportsTable();
            renderLatestInterviewsTable();
            showSection('dashboard-section'); // Başlangıçta Dashboard'u göster
        });
    </script>
</body>
</html>
